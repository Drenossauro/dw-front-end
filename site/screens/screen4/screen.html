<div class="screen-container">    
    <div class="emanuel-main-4">
        <div id="emanuel-jogador">
            <img src="images/mensagem.png" alt="mensagem">
        </div>

        <div id="emanuel-lupa">
            <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
            <lottie-player src="https://assets6.lottiefiles.com/packages/lf20_n4RinHSVJ4.json"  background="transparent"  speed="1"  style="width: 300px; height: 300px;"  loop  autoplay></lottie-player>
        </div>
    </div>
</div>

<script>
    functionCallRegister.register(WAITING_SCREEN, loadScreen4)

    function loadScreen4() {
        watchChangeInMatch()
    }

    function watchChangeInMatch() {
        const token = sessionStorage.getItem('token')
        const currentPlayer = parseInt(sessionStorage.getItem('player'))

        const intervalId = setInterval(() => {
            axios.get(`${URL_EXISTING_GAME}?token_da_sala=${token}`)
                .then(function (response) {
                    if (response.data['quem-joga'] == currentPlayer) {
                        clearInterval(intervalId)

                        const otherPlayerLabel = sessionStorage.getItem('player') == 1 ? PLAYER2 : PLAYER1
                        const game = JSON.parse(sessionStorage.getItem('game'))

                        const oldPoints = game[otherPlayerLabel].pontuacao
                        const newPoints = response.data[otherPlayerLabel].pontuacao
                        const diffPoints = newPoints - oldPoints

                        const nextScreenOfPoints = diffPoints > 0 ? OTHER_PLAYER_SUCCESS_GUESS_SCREEN : OTHER_PLAYER_WRONG_GUESS_SCREEN

                        const {player1, player2} = response.data
                        sessionStorage.setItem('game', JSON.stringify({ player1, player2 }))


                        // bug na tela de waiting
                        if (checkEndGame()) {
                            showScreen(END_GAME_SCREEN)
                        } else {
                            
                            if (response.data.status == 'upload') {
                                showScreen(nextScreenOfPoints)

                                setTimeout(() => {
                                    showScreen(UPLOAD_SCREEN, {tip: response.data['palavra-chave']})
                                }, 1500)
                            } else {
                                showScreen(DRAW_SCREEN)
                            }
                        }
                    }
                }).catch(function (error) {
                    toast(error)
                })  
        }, 1000)
    }
</script>